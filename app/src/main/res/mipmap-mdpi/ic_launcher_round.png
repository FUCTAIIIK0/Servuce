package com.lampa.eyesmart.activities.watch;

import android.content.Intent;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Bundle;
import android.util.DisplayMetrics;
import android.util.Log;
import android.view.View;
import android.view.animation.Animation;
import android.view.animation.LinearInterpolator;
import android.view.animation.RotateAnimation;
import android.widget.Button;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.TextView;

import com.lampa.eyesmart.activities.BaseActivity;
import com.lampa.smart.R;
import com.lampa.eyesmart.components.ELog;
import com.lampa.eyesmart.components.Filters;
import com.lampa.objects.TaskObject;

/**
 * Created by User on 31.10.2017.
 */
public class OrderActivity extends BaseActivity {
    private static final String TAG = "OrderActivity";

    ImageView imageView;
    TextView textView;

    ImageButton buttonYes;
    ImageButton buttonNo;
    TaskObject taskObject;

    @Override
    public void start() {
        super.start();
        setContentView(R.layout.order_activity);

        ELog.d(TAG, "start");

        imageView = findViewById(R.id.imageView);
        textView = findViewById(R.id.textView);

        buttonYes = findViewById(R.id.buttonYes);
        buttonNo = findViewById(R.id.buttonNo);

        buttonYes.setOnClickListener(v -> {
            Intent intent = new Intent();
            intent.setAction(Filters.ACTION_RESULT_ORDER);
            intent.putExtra("result", true);
            intent.putExtra("id", taskObject.getId());
            sendBroadcast(intent);

            finish();
        });

        buttonNo.setOnClickListener(v -> {
            Intent intent = new Intent();
            intent.setAction(Filters.ACTION_RESULT_ORDER);
            intent.putExtra("result", false);
            intent.putExtra("id", taskObject.getId());
            sendBroadcast(intent);

            finish();
        });

        //
        if (getIntent().hasExtra("object")) {
            taskObject = (TaskObject) getIntent().getSerializableExtra("object");
            onMessage(taskObject);
        }

        RotateAnimation rotate = new RotateAnimation(0, 360, Animation.RELATIVE_TO_SELF, 0.5f, Animation.RELATIVE_TO_SELF, 0.5f);
        rotate.setDuration(1000);
        rotate.setRepeatCount(Animation.INFINITE);
        rotate.setRepeatMode(Animation.RESTART);
        rotate.setInterpolator(new LinearInterpolator());

        ImageView image = findViewById(R.id.rotate);

        image.startAnimation(rotate);
    }

    @Override
    protected void stop() {
        super.onDestroy();
    }

    public void onMessage(final TaskObject taskObject) {
        // set image
        if(taskObject.getImage() != 